import json
import cv2
import requests
import base64
import os
import sys
import matplotlib.pyplot as plt
import numpy as np


JSON = "{'boxes': [{'box': {'topX': 0.024197921752929688, 'topY': 0.10412303924560547, 'bottomX': 1.0, 'bottomY': 0.9910374145507812}, 'label': 'person', 'score': 0.885036051273346}, {'box': {'topX': 0.036307182312011715, 'topY': 0.5799140625, 'bottomX': 0.2956024169921875, 'bottomY': 0.9967752075195313}, 'label': 'person', 'score': 0.14566011726856232}, {'box': {'topX': 0.0015069127082824707, 'topY': 0.6938196411132812, 'bottomX': 0.06580157470703125, 'bottomY': 1.0}, 'label': 'person', 'score': 0.07808578759431839}, {'box': {'topX': 0.12477657318115234, 'topY': 0.2055313720703125, 'bottomX': 0.8564356689453125, 'bottomY': 0.8263656616210937}, 'label': 'person', 'score': 0.07542192935943604}, {'box': {'topX': 0.04156278610229492, 'topY': 0.6677349853515625, 'bottomX': 0.22758395385742186, 'bottomY': 0.9979415893554687}, 'label': 'person', 'score': 0.07183773815631866}, {'box': {'topX': 0.028698225021362305, 'topY': 0.581272705078125, 'bottomX': 0.3385279541015625, 'bottomY': 0.9865756225585938}, 'label': 'dog', 'score': 0.06479538977146149}, {'box': {'topX': 0.029764089584350586, 'topY': 0.5770305786132812, 'bottomX': 0.3185436706542969, 'bottomY': 0.9956897583007812}, 'label': 'elephant', 'score': 0.07240914553403854}, {'box': {'topX': 0.010687980651855469, 'topY': 0.060514945983886716, 'bottomX': 1.0, 'bottomY': 0.9794849853515625}, 'label': 'umbrella', 'score': 0.08304286003112793}, {'box': {'topX': 0.6761974487304687, 'topY': 0.7587564086914063, 'bottomX': 1.0, 'bottomY': 0.9974493408203124}, 'label': 'handbag', 'score': 0.07084591686725616}, {'box': {'topX': 0.7373052978515625, 'topY': 0.80835595703125, 'bottomX': 0.97286572265625, 'bottomY': 0.9965741577148437}, 'label': 'handbag', 'score': 0.0617266483604908}, {'box': {'topX': 0.32666586303710937, 'topY': 0.8278748779296875, 'bottomX': 0.46267669677734374, 'bottomY': 1.0}, 'label': 'tie', 'score': 0.23128046095371246}, {'box': {'topX': 0.21339564514160156, 'topY': 0.8331031494140625, 'bottomX': 0.4449940185546875, 'bottomY': 0.9969956665039063}, 'label': 'tie', 'score': 0.14175355434417725}, {'box': {'topX': 0.5508051147460937, 'topY': 0.7660355834960938, 'bottomX': 0.6960949096679687, 'bottomY': 1.0}, 'label': 'tie', 'score': 0.1356254518032074}, {'box': {'topX': 0.34700515747070315, 'topY': 0.8042413330078125, 'bottomX': 0.5129447021484375, 'bottomY': 0.9964620971679687}, 'label': 'tie', 'score': 0.12109807133674622}, {'box': {'topX': 0.16017654418945312, 'topY': 0.829460205078125, 'bottomX': 0.34707867431640627, 'bottomY': 0.9986345825195313}, 'label': 'tie', 'score': 0.11069774627685547}, {'box': {'topX': 0.22218109130859376, 'topY': 0.8421001586914062, 'bottomX': 0.3378673400878906, 'bottomY': 0.99753515625}, 'label': 'tie', 'score': 0.10969635844230652}, {'box': {'topX': 0.26964425659179686, 'topY': 0.8513101806640625, 'bottomX': 0.3644767456054688, 'bottomY': 0.9951571044921875}, 'label': 'tie', 'score': 0.10966213792562485}, {'box': {'topX': 0.185767822265625, 'topY': 0.7232882080078125, 'bottomX': 0.48305740356445315, 'bottomY': 0.9935726318359375}, 'label': 'tie', 'score': 0.09375995397567749}, {'box': {'topX': 0.28729824829101563, 'topY': 0.7214307861328125, 'bottomX': 0.464893310546875, 'bottomY': 1.0}, 'label': 'tie', 'score': 0.08543838560581207}, {'box': {'topX': 0.24152507019042968, 'topY': 0.7986541748046875, 'bottomX': 0.5453356323242188, 'bottomY': 0.9996500854492187}, 'label': 'tie', 'score': 0.08162803947925568}, {'box': {'topX': 0.28373141479492187, 'topY': 0.7661784057617187, 'bottomX': 0.7825051879882813, 'bottomY': 0.9970789794921875}, 'label': 'tie', 'score': 0.07908948510885239}, {'box': {'topX': 0.35493972778320315, 'topY': 0.8620598754882812, 'bottomX': 0.47661993408203124, 'bottomY': 0.9978930053710937}, 'label': 'tie', 'score': 0.07817934453487396}, {'box': {'topX': 0.3445216979980469, 'topY': 0.7839789428710937, 'bottomX': 0.6218919067382812, 'bottomY': 0.9966478881835937}, 'label': 'tie', 'score': 0.07786690443754196}, {'box': {'topX': 0.22553939819335939, 'topY': 0.676255859375, 'bottomX': 0.3684505920410156, 'bottomY': 0.8447680053710938}, 'label': 'tie', 'score': 0.07782939076423645}, {'box': {'topX': 0.19250140380859376, 'topY': 0.65855224609375, 'bottomX': 0.5925532836914063, 'bottomY': 1.0}, 'label': 'tie', 'score': 0.07303151488304138}, {'box': {'topX': 0.2782004089355469, 'topY': 0.8230709228515625, 'bottomX': 0.39007632446289064, 'bottomY': 0.9878937377929687}, 'label': 'tie', 'score': 0.07007624208927155}, {'box': {'topX': 0.22545390319824218, 'topY': 0.6512195434570313, 'bottomX': 0.41454608154296874, 'bottomY': 0.8987609252929688}, 'label': 'tie', 'score': 0.06243211030960083}, {'box': {'topX': 0.2858776245117188, 'topY': 0.8613111572265625, 'bottomX': 0.3477408142089844, 'bottomY': 0.9862180786132813}, 'label': 'tie', 'score': 0.061964161694049835}, {'box': {'topX': 0.2886835632324219, 'topY': 0.9004834594726563, 'bottomX': 0.34852032470703126, 'bottomY': 0.9982449951171875}, 'label': 'tie', 'score': 0.060545094311237335}, {'box': {'topX': 0.22311363220214844, 'topY': 0.6712909545898438, 'bottomX': 0.37319149780273436, 'bottomY': 0.84180517578125}, 'label': 'baseball glove', 'score': 0.10284619778394699}, {'box': {'topX': 0.22311363220214844, 'topY': 0.6712909545898438, 'bottomX': 0.37319149780273436, 'bottomY': 0.84180517578125}, 'label': 'bottle', 'score': 0.09218229353427887}, {'box': {'topX': 0.7616532592773437, 'topY': 0.001443037986755371, 'bottomX': 0.8825595092773437, 'bottomY': 0.09686994171142578}, 'label': 'bottle', 'score': 0.0629718154668808}, {'box': {'topX': 0.22311363220214844, 'topY': 0.6712909545898438, 'bottomX': 0.37319149780273436, 'bottomY': 0.84180517578125}, 'label': 'wine glass', 'score': 0.16592048108577728}, {'box': {'topX': 0.19544439697265625, 'topY': 0.6038201293945312, 'bottomX': 0.3782462158203125, 'bottomY': 0.8577996215820313}, 'label': 'wine glass', 'score': 0.1364555060863495}, {'box': {'topX': 0.03243621826171875, 'topY': 0.576884765625, 'bottomX': 0.3532019348144531, 'bottomY': 0.9936155395507813}, 'label': 'wine glass', 'score': 0.11317777633666992}, {'box': {'topX': 0.08295932006835938, 'topY': 0.575632568359375, 'bottomX': 0.3732424621582031, 'bottomY': 0.84954248046875}, 'label': 'wine glass', 'score': 0.07736348360776901}, {'box': {'topX': 0.16282708740234375, 'topY': 0.6234008178710938, 'bottomX': 0.39099472045898437, 'bottomY': 0.9851934814453125}, 'label': 'wine glass', 'score': 0.0606444776058197}, {'box': {'topX': 0.22238658142089843, 'topY': 0.6523063354492188, 'bottomX': 0.37101043701171876, 'bottomY': 0.843829345703125}, 'label': 'cup', 'score': 0.22952286899089813}, {'box': {'topX': 0.20654989624023437, 'topY': 0.5436004028320313, 'bottomX': 0.3787786865234375, 'bottomY': 0.8584334716796875}, 'label': 'cup', 'score': 0.09494331479072571}, {'box': {'topX': 0.262011474609375, 'topY': 0.6043301391601562, 'bottomX': 0.3345925598144531, 'bottomY': 0.6826115112304687}, 'label': 'spoon', 'score': 0.07462195307016373}, {'box': {'topX': 0.22311363220214844, 'topY': 0.6712909545898438, 'bottomX': 0.37319149780273436, 'bottomY': 0.84180517578125}, 'label': 'donut', 'score': 0.25347623229026794}, {'box': {'topX': 0.2233643493652344, 'topY': 0.6651954345703125, 'bottomX': 0.3746467590332031, 'bottomY': 0.8456997680664062}, 'label': 'cake', 'score': 0.0870867371559143}, {'box': {'topX': 0.0, 'topY': 0.7058231201171875, 'bottomX': 0.061360977172851563, 'bottomY': 0.9914221801757812}, 'label': 'chair', 'score': 0.08850588649511337}, {'box': {'topX': 0.11517620086669922, 'topY': 0.784584716796875, 'bottomX': 0.9521387939453125, 'bottomY': 0.975415283203125}, 'label': 'chair', 'score': 0.06832099705934525}, {'box': {'topX': 0.0005712604522705078, 'topY': 0.8914630737304687, 'bottomX': 0.07079498291015625, 'bottomY': 1.0}, 'label': 'chair', 'score': 0.06729618459939957}, {'box': {'topX': 0.001815347671508789, 'topY': 0.6990701904296875, 'bottomX': 0.06256645965576171, 'bottomY': 0.9709691772460938}, 'label': 'tv', 'score': 0.10010302066802979}, {'box': {'topX': 0.0006728911399841308, 'topY': 0.7105567016601563, 'bottomX': 0.05358978271484375, 'bottomY': 0.903041748046875}, 'label': 'tv', 'score': 0.07546204328536987}, {'box': {'topX': 0.22274371337890625, 'topY': 0.6498458862304688, 'bottomX': 0.3745500793457031, 'bottomY': 0.8443284301757813}, 'label': 'remote', 'score': 0.12787531316280365}, {'box': {'topX': 0.1411000061035156, 'topY': 0.63966796875, 'bottomX': 0.2773860778808594, 'bottomY': 0.7316181640625}, 'label': 'remote', 'score': 0.06721062958240509}, {'box': {'topX': 0.17443136596679687, 'topY': 0.6089608154296875, 'bottomX': 0.3211595458984375, 'bottomY': 0.7310419921875}, 'label': 'remote', 'score': 0.06656203418970108}, {'box': {'topX': 0.15841998291015624, 'topY': 0.5960692138671875, 'bottomX': 0.3307806396484375, 'bottomY': 0.7812628784179687}, 'label': 'remote', 'score': 0.062344107776880264}, {'box': {'topX': 0.22274371337890625, 'topY': 0.6498458862304688, 'bottomX': 0.3745500793457031, 'bottomY': 0.8443284301757813}, 'label': 'cell phone', 'score': 0.20360396802425385}, {'box': {'topX': 0.262011474609375, 'topY': 0.6043301391601562, 'bottomX': 0.3345925598144531, 'bottomY': 0.6826115112304687}, 'label': 'cell phone', 'score': 0.12843380868434906}, {'box': {'topX': 0.04227237701416016, 'topY': 0.5808030395507813, 'bottomX': 0.24652037048339845, 'bottomY': 0.9906739501953125}, 'label': 'cell phone', 'score': 0.12018375843763351}, {'box': {'topX': 0.17443136596679687, 'topY': 0.6089608154296875, 'bottomX': 0.3211595458984375, 'bottomY': 0.7310419921875}, 'label': 'cell phone', 'score': 0.09952004998922348}, {'box': {'topX': 0.12422698211669922, 'topY': 0.65917578125, 'bottomX': 0.23465693664550782, 'bottomY': 0.7461040649414062}, 'label': 'cell phone', 'score': 0.0992036685347557}, {'box': {'topX': 0.19639361572265626, 'topY': 0.5728731689453125, 'bottomX': 0.3470559387207031, 'bottomY': 0.7289763793945313}, 'label': 'cell phone', 'score': 0.09802994132041931}, {'box': {'topX': 0.15841998291015624, 'topY': 0.5960692138671875, 'bottomX': 0.3307806396484375, 'bottomY': 0.7812628784179687}, 'label': 'cell phone', 'score': 0.09651698172092438}, {'box': {'topX': 0.26290399169921874, 'topY': 0.5683660278320313, 'bottomX': 0.3485113525390625, 'bottomY': 0.6813731079101563}, 'label': 'cell phone', 'score': 0.09282252937555313}, {'box': {'topX': 0.22763536071777343, 'topY': 0.6098648071289062, 'bottomX': 0.3336973876953125, 'bottomY': 0.715179443359375}, 'label': 'cell phone', 'score': 0.091937355697155}, {'box': {'topX': 0.1411000061035156, 'topY': 0.63966796875, 'bottomX': 0.2773860778808594, 'bottomY': 0.7316181640625}, 'label': 'cell phone', 'score': 0.0862264558672905}, {'box': {'topX': 0.1920745086669922, 'topY': 0.6476910400390625, 'bottomX': 0.34295101928710936, 'bottomY': 0.799375732421875}, 'label': 'cell phone', 'score': 0.08403844386339188}, {'box': {'topX': 0.20654989624023437, 'topY': 0.5436004028320313, 'bottomX': 0.3787786865234375, 'bottomY': 0.8584334716796875}, 'label': 'cell phone', 'score': 0.08159012347459793}, {'box': {'topX': 0.28373141479492187, 'topY': 0.7661784057617187, 'bottomX': 0.7825051879882813, 'bottomY': 0.9970789794921875}, 'label': 'cell phone', 'score': 0.08106588572263718}, {'box': {'topX': 0.05540069580078125, 'topY': 0.59613916015625, 'bottomX': 0.29102325439453125, 'bottomY': 0.8633828125}, 'label': 'cell phone', 'score': 0.07777395099401474}, {'box': {'topX': 0.2188302001953125, 'topY': 0.5419635009765625, 'bottomX': 0.34868099975585937, 'bottomY': 0.6935181884765625}, 'label': 'cell phone', 'score': 0.07759252935647964}, {'box': {'topX': 0.23070809936523437, 'topY': 0.5376286010742187, 'bottomX': 0.36217547607421874, 'bottomY': 0.7609513549804687}, 'label': 'cell phone', 'score': 0.07685452699661255}, {'box': {'topX': 0.1329615478515625, 'topY': 0.6767227783203125, 'bottomX': 0.20570661926269532, 'bottomY': 0.7320955810546875}, 'label': 'cell phone', 'score': 0.07454235851764679}, {'box': {'topX': 0.09041164398193359, 'topY': 0.6663492431640625, 'bottomX': 0.22519227600097655, 'bottomY': 0.8388164672851562}, 'label': 'cell phone', 'score': 0.07450670748949051}, {'box': {'topX': 0.16576513671875, 'topY': 0.562020263671875, 'bottomX': 0.33042633056640625, 'bottomY': 0.69712744140625}, 'label': 'cell phone', 'score': 0.07263805717229843}, {'box': {'topX': 0.09539674377441407, 'topY': 0.580962646484375, 'bottomX': 0.314871337890625, 'bottomY': 0.7296428833007812}, 'label': 'cell phone', 'score': 0.07049460709095001}, {'box': {'topX': 0.0, 'topY': 0.7058231201171875, 'bottomX': 0.061360977172851563, 'bottomY': 0.9914221801757812}, 'label': 'cell phone', 'score': 0.06822331994771957}, {'box': {'topX': 0.2534549102783203, 'topY': 0.6174682006835938, 'bottomX': 0.346305419921875, 'bottomY': 0.7300753173828125}, 'label': 'cell phone', 'score': 0.06742962449789047}, {'box': {'topX': 0.5522316284179688, 'topY': 0.7684415893554688, 'bottomX': 0.6985626831054688, 'bottomY': 1.0}, 'label': 'cell phone', 'score': 0.06663225591182709}, {'box': {'topX': 0.09018245697021485, 'topY': 0.6475628662109375, 'bottomX': 0.21615184020996095, 'bottomY': 0.7702703857421875}, 'label': 'cell phone', 'score': 0.06243540346622467}, {'box': {'topX': 0.012098598480224609, 'topY': 0.6736862182617187, 'bottomX': 0.170234130859375, 'bottomY': 0.9541383056640625}, 'label': 'cell phone', 'score': 0.06130613014101982}, {'box': {'topX': 0.0, 'topY': 0.053405075073242186, 'bottomX': 1.0, 'bottomY': 0.9865949096679687}, 'label': 'refrigerator', 'score': 0.17886114120483398}, {'box': {'topX': 0.758162353515625, 'topY': 0.0008826303482055664, 'bottomX': 0.8878219604492188, 'bottomY': 0.0965764389038086}, 'label': 'clock', 'score': 0.10417484492063522}, {'box': {'topX': 0.2233643493652344, 'topY': 0.6651954345703125, 'bottomX': 0.3746467590332031, 'bottomY': 0.8456997680664062}, 'label': 'clock', 'score': 0.08267587423324585}, {'box': {'topX': 0.262011474609375, 'topY': 0.6043301391601562, 'bottomX': 0.3345925598144531, 'bottomY': 0.6826115112304687}, 'label': 'scissors', 'score': 0.0678458958864212}, {'box': {'topX': 0.036604328155517576, 'topY': 0.5824512939453125, 'bottomX': 0.35991644287109376, 'bottomY': 0.9227920532226562}, 'label': 'hair drier', 'score': 0.07299836724996567}, {'box': {'topX': 0.22274371337890625, 'topY': 0.6498458862304688, 'bottomX': 0.3745500793457031, 'bottomY': 0.8443284301757813}, 'label': 'hair drier', 'score': 0.07219696044921875}, {'box': {'topX': 0.262011474609375, 'topY': 0.6043301391601562, 'bottomX': 0.3345925598144531, 'bottomY': 0.6826115112304687}, 'label': 'toothbrush', 'score': 0.1550028920173645}, {'box': {'topX': 0.22238658142089843, 'topY': 0.6523063354492188, 'bottomX': 0.37101043701171876, 'bottomY': 0.843829345703125}, 'label': 'toothbrush', 'score': 0.12833534181118011}, {'box': {'topX': 0.2752884521484375, 'topY': 0.5514656982421875, 'bottomX': 0.35112823486328126, 'bottomY': 0.67654541015625}, 'label': 'toothbrush', 'score': 0.11251778900623322}, {'box': {'topX': 0.32505859375, 'topY': 0.8151494750976562, 'bottomX': 0.46269729614257815, 'bottomY': 0.9987329711914062}, 'label': 'toothbrush', 'score': 0.10010950267314911}, {'box': {'topX': 0.23070809936523437, 'topY': 0.5376286010742187, 'bottomX': 0.36217547607421874, 'bottomY': 0.7609513549804687}, 'label': 'toothbrush', 'score': 0.08540895581245422}, {'box': {'topX': 0.2471277618408203, 'topY': 0.551618408203125, 'bottomX': 0.39287222290039064, 'bottomY': 0.8871441040039062}, 'label': 'toothbrush', 'score': 0.08479626476764679}, {'box': {'topX': 0.19639361572265626, 'topY': 0.5728731689453125, 'bottomX': 0.3470559387207031, 'bottomY': 0.7289763793945313}, 'label': 'toothbrush', 'score': 0.08254753798246384}, {'box': {'topX': 0.5385797119140625, 'topY': 0.7577952270507813, 'bottomX': 0.7032904663085937, 'bottomY': 0.9981718139648438}, 'label': 'toothbrush', 'score': 0.08089364320039749}, {'box': {'topX': 0.28729824829101563, 'topY': 0.7214307861328125, 'bottomX': 0.464893310546875, 'bottomY': 1.0}, 'label': 'toothbrush', 'score': 0.08036425709724426}, {'box': {'topX': 0.22545390319824218, 'topY': 0.6512195434570313, 'bottomX': 0.41454608154296874, 'bottomY': 0.8987609252929688}, 'label': 'toothbrush', 'score': 0.0770931988954544}, {'box': {'topX': 0.2553205871582031, 'topY': 0.5192821655273437, 'bottomX': 0.35506878662109376, 'bottomY': 0.6926975708007812}, 'label': 'toothbrush', 'score': 0.07546859979629517}, {'box': {'topX': 0.288244873046875, 'topY': 0.5649988403320313, 'bottomX': 0.3493773193359375, 'bottomY': 0.6566392211914063}, 'label': 'toothbrush', 'score': 0.07536326348781586}, {'box': {'topX': 0.34700515747070315, 'topY': 0.8042413330078125, 'bottomX': 0.5129447021484375, 'bottomY': 0.9964620971679687}, 'label': 'toothbrush', 'score': 0.07382902503013611}, {'box': {'topX': 0.18663177490234376, 'topY': 0.6611481323242188, 'bottomX': 0.4935660400390625, 'bottomY': 0.99276953125}, 'label': 'toothbrush', 'score': 0.06610105186700821}, {'box': {'topX': 0.28373141479492187, 'topY': 0.7661784057617187, 'bottomX': 0.7825051879882813, 'bottomY': 0.9970789794921875}, 'label': 'toothbrush', 'score': 0.06551613658666611}, {'box': {'topX': 0.2534549102783203, 'topY': 0.6174682006835938, 'bottomX': 0.346305419921875, 'bottomY': 0.7300753173828125}, 'label': 'toothbrush', 'score': 0.06492651998996735}, {'box': {'topX': 0.19153189086914063, 'topY': 0.5988421020507813, 'bottomX': 0.33083233642578125, 'bottomY': 0.7050164184570312}, 'label': 'toothbrush', 'score': 0.06293592602014542}, {'box': {'topX': 0.20665763854980468, 'topY': 0.5006410217285157, 'bottomX': 0.37145147705078124, 'bottomY': 0.8593589477539062}, 'label': 'toothbrush', 'score': 0.06056655943393707}]}"


IMAGE_PATH = "0.jpg"

# For each box, find the best matching anchor box   

with open(IMAGE_PATH, 'rb') as f:
    original_image = f.read()


with open('out.json', 'r') as f:
    bounding_boxes = json.load(f)
    
# GET THE HIGHEST SCORED BOXES

boxes = []
for box in bounding_boxes[0]['boxes']:
    print('box is', box['label'], box['score'])
    xmin = box['box']['bottomX'] * 300
    ymin = box['box']['bottomY'] * 300
    xmax = box['box']['topX'] * 300
    ymax = box['box']['topY'] * 300
    if box['score'] > 0.1 and box['label'] == 'person':
        score = box['box'].get('score')        
        boxes.append([xmin, ymin, xmax, ymax])
    

boxes = np.array(boxes)

# Plot the boxes on the image
image = cv2.imread(IMAGE_PATH)
for box in boxes:
    cv2.rectangle(image, (int(box[0]), int(box[1])), (int(box[2]), int(box[3])), (0,0,255), 2)
    
cv2.imshow('image', image)

cv2.waitKey(0)
cv2.destroyAllWindows()
